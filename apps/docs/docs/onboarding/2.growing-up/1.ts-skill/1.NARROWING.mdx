---
description: ì½”ë“œì˜ ì•ˆì •ì„±ê³¼ ì‹ ë¢°ì„±ì„ ë†’ì—¬ì£¼ëŠ” íƒ€ì…ì„ ì¢íˆëŠ” ì—¬ì„¯ê°€ì§€ ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤.
---

# Narrowing

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `Narrowing`ì€ íƒ€ì…ì˜ ë²”ìœ„ë¥¼ ì¢íˆëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŠ” ë³€ìˆ˜ë‚˜ í‘œí˜„ì‹ì˜ íƒ€ì…ì„ ë³´ë‹¤ êµ¬ì²´ì ìœ¼ë¡œ ì¶”ë¡ í•˜ê±°ë‚˜ ì§€ì •í•˜ì—¬ ì½”ë“œì˜ ì•ˆì „ì„±ì„ ë†’ì´ëŠ” ê³¼ì •ì„ ë§í•©ë‹ˆë‹¤.

## Type Guard

ì´ë²ˆ ì„¹ì…˜ì—ì„œëŠ” **íƒ€ì…ì„ ì¢íˆëŠ” ì—¬ì„¯ ê°€ì§€ ë°©ë²•**ì„ ì†Œê°œí•©ë‹ˆë‹¤. ì´ ë°©ë²•ë“¤ì„ í†µí•´ ì½”ë“œì˜ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì •ì˜í•˜ê³ , ì ì¬ì ì¸ ì˜¤ë¥˜ë¥¼ ì‚¬ì „ì— ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ ì•ˆì „ì„±ê³¼ ì½”ë“œì˜ ì‹ ë¢°ì„±ì„ ë”ìš± ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&#x20;


## 1. ì¡°ê±´ë¬¸ì„ ì´ìš©í•œ íƒ€ì… í™•ì¸

```typescript
type Animal = {
  name: string;
  legs?: number;
};
```

ìœ„ `Animal` íƒ€ì…ì„ ì´ìš©í•˜ëŠ” ì•„ë˜ `addLeg` í•¨ìˆ˜ëŠ” íƒ€ì… ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
function addLeg(animal: Animal) {
  animal.legs = animal.legs + 1; // ğŸ’¥ - Object is possibly 'undefined'
}
```

legs í”„ë¡œí¼í‹°ê°€ `undefined`ê°€ ë ìˆ˜ ìˆê¸° ë•Œë¬¸ì— íƒ€ì… ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  `undefined`ì— `1`ì„ ë”í•˜ëŠ” ê²ƒ ë˜í•œ ë§ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§€ê¸ˆ ìƒí™©ì—ì„œ íƒ€ì… ì—ëŸ¬ë¥¼ í”¼í•˜ê¸° ìœ„í•´ì„œëŠ” `legs` í”„ë¡œí¼í‹°ë¥¼ ì´ìš©í•˜ê¸° ì „ì— `legs`ê°€ `truthy`ì¸ì§€ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¤.

```typescript
function addLeg(animal: Animal) {
  if (animal.legs) { 
    animal.legs = animal.legs + 1;
  }
}
```

`legs`ëŠ” `ifë¬¸` ì „ì—ëŠ” number | undefined íƒ€ì…ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ, `ifë¬¸`í›„ì—ëŠ” number íƒ€ì…ìœ¼ë¡œ ì¢í˜€ì§€ê²Œ(narrow) ë©ë‹ˆë‹¤.

ì´ ë°©ì‹ì˜ Type narrowingì€ ì—¬ëŸ¬ íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ë³€ìˆ˜ì—ì„œ `null`ê³¼ `undefined`ë¥¼ ì œì™¸ì‹œí‚¤ëŠ”ë°ì— ìœ ìš©í•œ ë°©ë²•ì…ë‹ˆë‹¤.

## 2. typeof íƒ€ì… ê°€ë“œ

ì¸ìê°€ `string`ì´ë©´ ë³µì‚¬í•˜ì—¬ ë¶™ì´ê³ , `number`ë¼ë©´ ê³±í•˜ê¸° 2ë¥¼ í•˜ëŠ” ì•„ë˜ í•¨ìˆ˜ë¥¼ ì‚´í´ë´…ì‹œë‹¤.

```typescript
function double(item: string | number) {
  if (typeof item === "string") {
    return item.concat(item); // item is of type string
  } else {
    return item + item; // item is of type number
  }
}
```

`item` ì¸ìëŠ” `ifë¬¸`ì „ì—ëŠ”`number`í˜¹ì€ `string` íƒ€ì…ì…ë‹ˆë‹¤. `ifë¬¸`ì•ˆì—ì„œëŠ” stringìœ¼ë¡œ ì¢í˜€ì§€ê³ , `elseë¬¸`ì—ì„œëŠ” numberë¡œ ì¢í˜€ì§€ê²Œ ë©ë‹ˆë‹¤.

ìœ„ ë°©ì‹ì„ `typeof` íƒ€ì… ê°€ë“œ íŒ¨í„´ì´ë¼ê³  í•©ë‹ˆë‹¤. **ì›ì‹œ íƒ€ì…ì„ type narrowingí•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.**



## 3. Instanceof íƒ€ì… ê°€ë“œ

ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” íƒ€ì…ë“¤ì€ ë³´í†µ ì›ì‹œ íƒ€ì…ë³´ë‹¤ ë³µì¡í•©ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ì‚´í´ë³´ì£ .

```typescript
class Person {
  constructor(
    public firstName: string,
    public surname: string
  ) {}
}
class Organisation {
  constructor(public name: string) {}
}
type Contact = Person | Organisation;
```

ì•„ë˜ í•¨ìˆ˜ëŠ” íƒ€ì…ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

```typescript
function sayHello(contact: Contact) {
  console.log("Hello " + contact.firstName);
  // ğŸ’¥ - Property 'firstName' does not exist on type 'Contact'.
}
```

ì—ëŸ¬ì˜ ì´ìœ ëŠ” `contact`ê°€ `firstName`í”„ë¡œí¼í‹°ë¥¼ ê°€ì§€ì§€ì•Šì€ `Organisation` íƒ€ì…ì¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í´ë˜ìŠ¤ íƒ€ì…ì„ ì´ìš©í•  ë•Œ `instanceof` íƒ€ì… ê°€ë“œë¥¼ ì´ìš©í•˜ë©´ í¸í•©ë‹ˆë‹¤.

```typescript
function sayHello(contact: Contact) {
  if (contact instanceof Person) {    
    console.log("Hello " + contact.firstName);
  }
}
```

`ifë¬¸`ì•ˆì—ì„œ `contact`ì˜ íƒ€ì…ì€ Personìœ¼ë¡œ ì¢í˜€ì§‘ë‹ˆë‹¤(narrow). ê·¸ëŸ¬ë¯€ë¡œ ìœ„ì—ì„œ ë°œìƒí–ˆë˜ ì—ëŸ¬ë¥¼ í”¼í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.



## 4. in íƒ€ì… ê°€ë“œ

ìš°ë¦¬ëŠ” íƒ€ì…ì„ í‘œí˜„í•  ë•Œ í•­ìƒ classë¥¼ ì´ìš©í•˜ì§„ ì•ŠìŠµë‹ˆë‹¤. ìœ„ì—ì„œ í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ í‘œí˜„ëœ íƒ€ì…ì„ ì•„ë˜ì²˜ëŸ¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤(with interface)

```typescript
interface Person {
  firstName: string;
  surname: string;
}
interface Organisation {
  name: string;
}
type Contact = Person | Organisation;
```

\
`instanceof` íƒ€ì… ê°€ë“œëŠ” interface í˜¹ì€ íƒ€ì… ë³„ëª…(aliases)ë“¤ì—ëŠ” ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ëŒ€ì‹ ì— ìš°ë¦¬ëŠ” `in` [íƒ€ì… ê°€ë“œ](https://www.typescriptlang.org/docs/handbook/advanced-types.html#using-the-in-operator)ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
function sayHello(contact: Contact) {
  if ("firstName" in contact) {    
    console.log("Hello " + contact.firstName);
  }
}
```

`ifë¬¸`ì•ˆì—ì„œ `contact`ëŠ” Person íƒ€ì…ìœ¼ë¡œ ì¢í˜€ì§€ê³  íƒ€ì… ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.



## 5. type predicate ë¥¼ ì´ìš©í•œ íƒ€ì… ê°€ë“œ

```typescript
type Rating = 1 | 2 | 3 | 4 | 5;

async function getRating(productId: string) {
  const response = await fetch(
    `/products/${productId}`
  );
  const product = await response.json();
  const rating = product.rating;
  return rating;
}
```

ìœ„ í•¨ìˆ˜ì˜ ë¦¬í„´ íƒ€ì…ì€ `Promise<any>` ë¡œ ì¶”ì¸¡ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì— ë³€ìˆ˜ë¥¼ í• ë‹¹í•˜ë©´ `any` íƒ€ì…ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.

```typescript
const rating = await getRating("1"); // type of rating is `any`
```

ì´ëŠ” ì•„ë¬´ëŸ° íƒ€ì… í™•ì¸ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë§ì…ë‹ˆë‹¤.

`type predicate`ë¥¼ ê°€ì§€ê²Œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ë©´ ìš°ë¦¬ì˜ ì½”ë“œëŠ” ë”ìš± íƒ€ì…ì— ì•ˆì •ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
function isValidRating(
  rating: any
): rating is Rating {
  if (!rating || typeof rating !== "number") {
    return false;
  }
  return (
    rating === 1 ||
    rating === 2 ||
    rating === 3 ||
    rating === 4 ||
    rating === 5
  );
}
```

`rating is Rating`ì€ ìœ„ í•¨ìˆ˜ì—ì„œ íƒ€ì… ì„œìˆ ì–´`type predicate`ì…ë‹ˆë‹¤.\
type predicateê°€ ì‚¬ìš©ëœë‹¤ë©´ ë°˜ë“œì‹œ booleanê°’ì„ ë¦¬í„´í•´ì•¼ í•©ë‹ˆë‹¤.\
ì•„ë˜ ì½”ë“œëŠ” ìœ„ì—ì„œ ì •ì˜í•œ type predicateë¥¼ ê°€ì§„ isValidRating í•¨ìˆ˜ë¥¼ ì´ìš©í•œ getRating í•¨ìˆ˜ì…ë‹ˆë‹¤.

```typescript
async function getRating(productId: string) {
  const response = await fetch(
    `/products/${productId}`
  );
  const product = await response.json();  const rating = product.rating;
  if (isValidRating(rating)) {
    return rating; // type of rating is `Rating`
  } else {
    return undefined;
  }
}
```

isValidRating()ì„ ì´ìš©í•˜ì˜€ê¸° ë•Œë¬¸ì— `ifë¬¸`ì•ˆì—ì„œ `rating`ì˜ íƒ€ì…ì€ Ratingì´ ë©ë‹ˆë‹¤.



## 6. assertion signature ì„ ì´ìš©í•œ íƒ€ì… ê°€ë“œ

getRatingì„ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ íƒ€ì…ê°€ë“œí•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.

```typescript
async function getRating(productId: string) {
  const response = await fetch(
    `/products/${productId}`
  );
  const product = await response.json();  const rating = product.rating;
  checkValidRating(rating); // should throw error if invalid rating
  return rating; // type should be narrowed to `Rating`
}
```

`checkValidRating` í•¨ìˆ˜ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ getRatingí•¨ìˆ˜ëŠ” ratingì´ ìœ íš¨í•˜ì§€ ì•Šì€ ê°’ì¼ ë•Œ ì—ëŸ¬ë¥¼ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  `checkValidRating`ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤ë©´ ê·¸ ê²°ê³¼ë¡œ ratingì˜ íƒ€ì…ì€ ì•Œì•„ì„œ ì¢í˜€ì§€ê²Œ(narrowed) ë©ë‹ˆë‹¤.

assertion ì‹œê·¸ë‹ˆì²˜ì™€ í•¨ê»˜ íƒ€ì… ê°€ë“œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
function checkValidRating(
  rating: any
): asserts rating is Rating {
  if (!rating || typeof rating !== "number") {
    throw new Error("Not a rating");
  }
  if (
    rating !== 1 &&
    rating !== 2 &&
    rating !== 3 &&
    rating !== 4 &&
    rating !== 5
  ) {
    throw new Error("Not a rating");
  }
}
```

`asserts rating is Rating` ì€ ìœ„ í•¨ìˆ˜ì˜ assertion signatureì…ë‹ˆë‹¤. ë§Œì•½ ìœ„ í•¨ìˆ˜ê°€ ì—ëŸ¬ì—†ì´ ë¦¬í„´ëœë‹¤ë©´ `rating` ì¸ìì˜ íƒ€ì…ì€ `Rating`ì˜ íƒ€ì…ìœ¼ë¡œ ë²”ìœ„ê°€ ì¢í˜€ì§‘ë‹ˆë‹¤.



## Reference

* [ì›ë¬¸](https://www.carlrippon.com/6-ways-to-narrow-types-in-typescript/)
* [ë²ˆì—­](https://medium.com/nodejs-server/type-narrowing-ts-f62fc28f413f)

