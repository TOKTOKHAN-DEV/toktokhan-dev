---
'@toktokhan-dev/cli-plugin-gen-api-react-query': patch
---

Instance Path & Comments & Query Key

# Instance Path

기존에 {name}.api.ts 파일에 에서 생성된 각 api class 의 instance 가
{name}.query.ts 파일로 이동되었습니다.

생성된 class 나 instance 를 axios instance 선언부애서 사용할 경우 해당 파일에서 instance 를 import 하고 있기 때문에 순환 참조가 일어납니다.

위 버그를 방지하기위해 class api 선언부와 axios instance 를 import 하여 새로운 api instance 를 생성하는 로직을 다른 파일로 분리했습니다.

#### 기존

```ts
//Auth.api.ts

import instance from '@/configs/axios/instance'

export class AuthApi {
    ...
}

export const authApi = new AuthApi({ instance })
```

```ts
// @/configs/axios/instance.ts

import axios, { AxiosError } from 'axios';
import { AuthApi, authApi } from '@/generated/swagger/Auth.api.ts'

const instance = axios.create({...});

const newAuthApi = new AuthApi({instance: axios.create()}) // Error - 순환 참조 발생

instance.interceptors.request.use(
  (config) => {...},
  (error) => {...},
);

instance.interceptors.response.use(
  (res) => {...},
  async (error: AxiosError) => {
    ...
    authApi.refresh() // Error - 순환참조 발생

  },
);

export default instance;
```

#### 변경

```ts
// Auth.api.ts
export class AuthApi {
    ...
}
// instance 선언부 제거
```

```ts
// Auth.query.ts
const authApi = new AuthApi({ instance })

const AUTH_QUERY_KEY = {...}
```

```ts
// @/configs/axios/instance.ts

import axios, { AxiosError } from 'axios';
import { AuthApi } from '@/generated/swagger/Auth.api.ts'

const instance = axios.create({...});

const authApi = new AuthApi({instance: axios.create()}) // no Error

instance.interceptors.request.use(
  (config) => {...},
  (error) => {...},
);

instance.interceptors.response.use(
  (res) => {...},
  async (error: AxiosError) => {...},
);

export default instance;
```

## Query Key

query key 의 정의 방식을 개선했습니다.

##### 기존

```ts
{
  GET_LIST: (variables?: Parameter<typeof someApi.getList>) =>
    ['GET_LIST', variabels].filter((v) => typeof v !== 'undefined')
}
```

##### 개선

```ts
const isDefined = () => {...}

{
  GET_LIST: (variables?: Parameter<typeof someApi.getList>) =>
    ['GET_LIST', variabels].filter(isDefined)
}
```

## Comment

아래 주석이 gen:api 가 생성하는 모든 파일에 추가되었습니다.

```
/**
 * !DO NOT EDIT THIS FILE
 *
 * 스크립트가 실행될때, 파일을 항상 새로 쓰기 때문에 파일 수정시 작성내용이 제거 될 수 있습니다.
 */

```
